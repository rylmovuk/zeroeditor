<html>
<head>

	<title>Zeroeditor - v 1.2.0</title>

	<!-- Engine fisico Matter.js-->
	<script src="res/scripts/matter.js"></script>

	<!-- Validatore di codice Esprima-->
	<script src="res/scripts/esprima.js"></script>



	<!-- Carica il gioco attuale -->
	<script src="res/app.js"></script>

  <!-- Editor di codice CodeMirror -->
  <link rel="stylesheet" href="../dist/styles.css" />
  <script src="../dist/zeroeditor.min.js"></script>


	<!-- Stili css, per posizioni e colori -->

	<link rel="stylesheet" href="res/styles/main.css">


</head>
<body>




	<!-- Elemento in cui verrà effettuato il render -->
	<div id="renderDiv"></div>

	<!-- Contiene il tasto per l'esecuzione del codice e il debug -->
	<div id="console">
		<p>Console	<button id="execute">Esegui</button><button id="stop">Stop</button></p>
		<hr><p id="output"></p>
	</div>

	<!-- Navbar con la scritta/il logo "Zerorobotics -->
	<div id="navbar"><img height=35px src="res/textures/logo.gif" style="margin: 10px;"></img></span></div>

	<!-- Editor di codice -->
	<form id="editor">
	<script>document.write('<textarea id="code" name="code">' + app.startingCode + '</textarea>');</script>	</form>

	<script>


		//In caso avvenga un errore in qualsiasi momento, avvisa l'utente e ferma eventuali simulazioni
		window.onerror = function (){
		  DEBUG_ERROR("");
		  clearInterval(appExecutionTimer);

		}

    let zEditor = new ZEditor({});
    window.editor = zEditor.editor;



		/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
		Gestione simulazione - Qui va il codice che fa funzionare l'esecuzione
		++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/
    document.getElementById('execute').addEventListener('click',
		  function(){ app.startExecution();}
    );

    document.getElementById('stop').addEventListener('click',
		  function(){ app.endExecution();}
    );





		/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
		Engine - Questo è il codice che inizializza l'engine fisico
		++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/

		//Inizializza Matter.js
		var engine = Matter.Engine.create();  //Crea l'Engine fisico
		var render = Matter.Render.create({   //Crea il Renderer
			element: document.getElementById("renderDiv"),
			engine: engine,
			options: {
				width: document.getElementById('renderDiv').clientWidth,
				height: document.getElementById('renderDiv').clientHeight,
				showAngleIndicator: false,
				wireframes: false,
				hasBounds: true
			}
		});

		//Inizializza il mondo come spiegato nello script app.js
		app.initWorld();

		// run the engine and the renderer
		Matter.Engine.run(engine);  	Matter.Render.run(render);

		var counter = 0;
		var onExecution = false;
		Matter.Events.on(engine, 'beforeUpdate', function(event) {
			counter++;
			if (counter >= 10 ) {
				if(onExecution) app.onExecution();
				// reset counter
				counter = 0;
			}
		});


		/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
		Resize - Gestisce il ridimensionamento della pagina
		++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/

		render.bounds.min.x = 0;
		render.bounds.max.x = 800;
		render.bounds.min.y = 0;
		render.bounds.max.y = 600;
		window.addEventListener('resize',function() {
		 render.context.canvas.width = document.getElementById('renderDiv').clientWidth;
		 render.options.width = document.getElementById('renderDiv').clientWidth;
		 render.canvas.width = document.getElementById('renderDiv').clientWidth;

		 render.context.canvas.height = document.getElementById('renderDiv').clientHeight;
		 render.options.height = document.getElementById('renderDiv').clientHeight;
		 render.canvas.height = document.getElementById('renderDiv').clientHeight;

		});
	</script>
</body>
</html>
